const path_ori = [
    'M97.49,225.89c-38.73,1.43-90.85-15.54-96.83-53.97-1.81-15.84,2.44-31.72,9.24-47.33,7.5-17.22,18.1-34.13,27.09-50.34C59.5,34.67,77.4,4.99,104.36.77c12.25-1.92,26.37,1.42,43.64,11.47,28.61,17.49,45.58,43.73,52.23,71.89,8.46,35.84.19,74.8-22.11,102.79-18.11,22.72-45.46,38.22-80.62,38.97Z',
    'M107.6,224.39c-22.07,1.26-89.17-1.7-105.28-46.74-8.31-23.22,10.18-49.83,24.94-69.76,16.72-22.58,37.17-52.89,61.67-75.59C113.41,9.6,141.94-5.5,174.8,2.35c21.81,5.25,42.52,16.55,58.5,32.17,17.63,17.22,29.5,39.69,30.73,65.07,1.99,45.01-31.43,79.94-55.38,95.38-40.18,28.45-83.26,29.2-101.05,29.42Z',
    'M77.43,201.63c-11.36.47-46.64,1.47-67.69-19.39-19.52-18.99-5.23-39.63,9.73-56.61C52.97,88.83,96.98,56.47,137.88,28.11,160.36,12.53,189.89-1.47,216.66.42c17.29,1.22,33.43,9.06,45.77,27.38,9.13,13.54,7.39,34.68-1.05,56.75-8.55,22.35-23.96,45.66-41.93,63.03-42.53,39.68-99.36,52.27-142.02,54.05Z',
    'M107.6,224.39c-22.07,1.26-89.17-1.7-105.28-46.74-8.31-23.22,10.18-49.83,24.94-69.76,16.72-22.58,37.17-52.89,61.67-75.59C113.41,9.6,141.94-5.5,174.8,2.35c21.81,5.25,42.52,16.55,58.5,32.17,17.63,17.22,29.5,39.69,30.73,65.07,1.99,45.01-31.43,79.94-55.38,95.38-40.18,28.45-83.26,29.2-101.05,29.42Z',
    'M122.6,201.62c-25.72-.56-60.3-6.15-86.13-20.53C12.8,167.91-3.53,147.36,1.01,116.55c4.04-27.39,17.48-58.66,30.31-83.03C45.41,6.77,66.61-4.3,96.62,1.95c25.56,5.33,53.06,17.68,75.92,35.33,22.87,17.65,41.1,40.61,48.13,67.12,7.99,30.14-1.97,54.22-20.64,70.88-19.73,17.61-49.18,26.92-77.43,26.34Z',
    'M171.78,202.26c-34.19,1.32-76.92-7.49-110.6-27.45-24.7-14.63-44.54-35.26-52.58-62.27C3.21,94.37.53,72.55.25,53.52.47,37.89-.78,8.95,16.59,2.9c32.84-11.42,100.9,16.38,136.13,39.08,24.69,15.91,44.13,32.96,62.09,53.07,24.39,27.32,33.78,54.07,27,74.02s-29.74,33.09-70.03,33.19Z',
    'M122.6,201.62c-25.72-.56-60.3-6.15-86.13-20.53C12.8,167.91-3.53,147.36,1.01,116.55c4.04-27.39,17.48-58.66,30.31-83.03C45.41,6.77,66.61-4.3,96.62,1.95c25.56,5.33,53.06,17.68,75.92,35.33,22.87,17.65,41.1,40.61,48.13,67.12,7.99,30.14-1.97,54.22-20.64,70.88-19.73,17.61-49.18,26.92-77.43,26.34Z']

const path = [
    'm0.48,1 c-0.191,0.006,-0.447,-0.069,-0.476,-0.239 c-0.009,-0.07,0.012,-0.141,0.045,-0.21 c0.037,-0.076,0.089,-0.151,0.133,-0.223 c0.111,-0.175,0.199,-0.307,0.331,-0.326 c0.06,-0.009,0.13,0.006,0.215,0.051 c0.141,0.077,0.224,0.194,0.257,0.318 c0.042,0.159,0.001,0.331,-0.109,0.455 c-0.089,0.101,-0.224,0.169,-0.397,0.173',
    'M0.289,1 c-0.042,0.002,-0.174,0.007,-0.252,-0.096 c-0.073,-0.094,-0.019,-0.197,0.036,-0.281 C0.197,0.441,0.361,0.28,0.514,0.139 C0.598,0.062,0.708,-0.007,0.808,0.002 c0.064,0.006,0.125,0.045,0.171,0.136 c0.034,0.067,0.028,0.172,-0.004,0.282 c-0.032,0.111,-0.089,0.227,-0.156,0.313 c-0.159,0.197,-0.37,0.259,-0.529,0.268',
    'M0.408,1 c-0.084,0.006,-0.338,-0.008,-0.399,-0.208 c-0.031,-0.103,0.039,-0.222,0.095,-0.311 c0.063,-0.101,0.141,-0.236,0.234,-0.337 C0.43,0.043,0.538,-0.025,0.662,0.01 c0.083,0.023,0.161,0.074,0.222,0.143 c0.067,0.077,0.112,0.177,0.116,0.29 c0.008,0.201,-0.119,0.356,-0.21,0.425 c-0.152,0.127,-0.316,0.13,-0.383,0.131',
    'M0.549,1 c-0.115,-0.003,-0.27,-0.031,-0.386,-0.102 C0.057,0.834,-0.016,0.732,0.005,0.579 c0.018,-0.136,0.078,-0.291,0.136,-0.412 C0.203,0.034,0.298,-0.021,0.433,0.01 c0.115,0.026,0.238,0.088,0.34,0.175 c0.102,0.088,0.184,0.202,0.216,0.333 c0.036,0.15,-0.009,0.269,-0.092,0.352 c-0.088,0.087,-0.22,0.134,-0.347,0.131',
    'M0.705,1 c-0.14,0.007,-0.316,-0.037,-0.454,-0.136 c-0.101,-0.072,-0.183,-0.174,-0.216,-0.308 C0.013,0.467,0.002,0.359,0.001,0.265 C0.002,0.187,-0.003,0.044,0.068,0.014 c0.135,-0.056,0.414,0.081,0.559,0.193 c0.101,0.079,0.181,0.163,0.255,0.263 c0.1,0.135,0.139,0.267,0.111,0.366 s-0.122,0.164,-0.287,0.164',
    'M0.549,1 c-0.115,-0.003,-0.27,-0.031,-0.386,-0.102 C0.057,0.834,-0.016,0.732,0.005,0.579 c0.018,-0.136,0.078,-0.291,0.136,-0.412 C0.203,0.034,0.298,-0.021,0.433,0.01 c0.115,0.026,0.238,0.088,0.34,0.175 c0.102,0.088,0.184,0.202,0.216,0.333 c0.036,0.15,-0.009,0.269,-0.092,0.352 c-0.088,0.087,-0.22,0.134,-0.347,0.131']

var scale = ['0.4,0.4','0.3,0.7','0.1,0.1','0.2,0.3','0.4,0.8','0.5,0.5','0.25,0.5']

//morphing animation

var snap = Snap("#svg_morphing");

var pa = snap.select('path');

var i = 0;

var duration = 10000; // アニメーション時間
var easing = mina.easing; // Snap.svgで定義されているイージング関数

let fadeStartTime = null; // フェードアウト開始時刻
const fadeDuration = 3000; // フェードアウト完了までの時間（ミリ秒）
let isFadingOut = false; // フェードアウトが既に始まったかどうかを管理するフラグ


setTimeout(AnimationSVG,500);

// スクロールイベントでフェードアウトをトリガー
window.addEventListener('scroll', () => {

    const scrollY = window.scrollY;
    const triggerScroll = 1; // フェードアウト開始のスクロール量

    if (scrollY > triggerScroll) {
        startFadeOut();
    }
});


function AnimationSVG() {

    i++;

    if (i === path.length) {
        i = 0;
    }

    pa.animate({path: path[i]},duration,easing,AnimationSVG);
}

function Scroll() {

    const triggerScroll = 50; // 拡大とフェードアウトを開始するスクロール量

    $(window).scroll(function () { 
        if ($(this).scrollTop() > triggerScroll) {
            
        }
    });
}


function updateMaskSizeAndOpacity(timestamp) {
    if (!fadeStartTime) fadeStartTime = timestamp; // 初回呼び出しで時刻を記録

    const elapsed = timestamp - fadeStartTime; // 経過時間の計算
    let scalex = 0.47;
    let scaley = 0.95 // 初期のスケール

    if (elapsed <= fadeDuration) {
        // 経過時間に応じて拡大とフェードアウトを計算
        scalex = 0.47 + (elapsed / fadeDuration) * 2; // 1 から 3 まで拡大
        scaley = 0.95 + (elapsed / fadeDuration) * 2; // 1 から 3 まで拡大
        opacity = 1 - (elapsed / fadeDuration);   // 1 から 0 までフェードアウト
    } else {
        // フェードアウト終了後、透明状態を維持
        opacity = 0;
    }

    const element = document.getElementById("path_scale");
    element.style.transform = `translate(0px,0px) scale(${scalex},${scaley})`;

    // 次のフレームで再度実行
    if (opacity > 0) {
        requestAnimationFrame(updateMaskSizeAndOpacity);
    }
}

// フェードアウトを開始する関数
function startFadeOut() {
    if (isFadingOut) return; // フェードアウトが既に始まっていれば何もしない
    isFadingOut = true; // フェードアウト開始フラグをセット
    fadeStartTime = null; // フェードアウト開始時刻をリセット
    requestAnimationFrame(updateMaskSizeAndOpacity);
}
